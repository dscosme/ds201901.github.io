<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"></head><body>
  <p>Some NFC stuff</p>
  <p id="message"></p>
<script>
try {
  const writer = new NFCWriter();
  const reader = new NFCReader();
}
catch(error) {
  document.getElementById("message").innerHTML = "No NFC there folks.";
}

reader.onreading = event => {
  const message = event.message;
  if (message.records[0].recordType == 'empty') {
    writer.push({
      records: [{ recordType: "text", data: 'Hello World' }]
    });
    return;
  }

  console.log(`Read message written by ${message.url}`);

  for (let record of message.records) {
    switch (record.recordType) {
      case "text":
        console.log(`Text: ${record.text()}`);
        document.getElementById("message").innerHTML = `Text: ${record.text()}`;
        break;
      case "url":
        console.log(`URL: ${record.text()}`);
        document.getElementById("message").innerHTML = `URL: ${record.text()}`;
        break;
      case "json":
        console.log(`JSON: ${record.json().myProperty}`);
        document.getElementById("message").innerHTML = `JSON: ${record.json().myProperty}`;
        break;
      case "opaque":
        if (record.mediaType.startsWith('image/')) {
          const blob = new Blob([record.arrayBuffer()], {type: record.mediaType});

          const img = document.createElement("img");
          img.src = URL.createObjectURL(blob);
          img.onload = () => window.URL.revokeObjectURL(this.src);

          document.body.appendChild(img);
        }
        break;
    }
  }
};

reader.scan();
</script>
</body></html>
